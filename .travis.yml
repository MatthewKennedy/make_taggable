---
os: linux
dist: bionic
language: ruby
cache: bundler

services:
  - mysql
  - postgresql

rvm:
  - 2.7
  - 2.6

env:
  - DB=sqlite3
  - DB=mysql
  - DB=postgresql

gemfile:
  - gemfiles/rails_5.gemfile
  - gemfiles/rails_6.gemfile
  - gemfiles/rails_6_1.gemfile
  - gemfiles/rails_master.gemfile

bundler_args: '--without local_development --jobs 3 --retry 3'

before_install:
  - gem update bundler

script: bundle exec rake

jobs:
  allow_failures:
    - rvm: ruby-head
  fast_finish: true
